# 배경

광고를 하고 난 후 트래픽이 몰릴 것을 예측하는 것은 쉽지만, 어느 정도 몰릴지 예측이 불가능한 상황도 존재한다.  
갑작스럽게 북한 미사일이 발사되어 사람들이 네이버 몰리는 경우가 그렇다.  
이 경우에 네이버가 다운(down)되는 것은 이상한 일이 아니다.  
API 요청이 과도하게 몰린다.  
이 상황을 어떻게 극복할 수 있나?

# 가정

요청이 들어오면 서버는 요청의 내용을 즉시 SQS에 담고 바로 응답한다.  
이후 SQS에 ELB, Lambda를 이용하여 메시지를 꺼내고, 메시지의 API를 비동기적으로 처리한다.  
클라이언트는 폴링, 콜백, 소켓 등의 방법으로 요청의 결과를 받는다.

# 반론1

클라이언트가 폴링, 콜백, 소켓 등으로 요청 결과를 받는 것은 비용이 너무 커서 그럴 바에 Queue를 쓰지 않는 게 낫다.  
이 경우에는 Queue에 담을 메시지를 정의해야 한다.  
가령 회원가입 시 할인 쿠폰을 준다고 할 때 할인 쿠폰 발급에 실패했다고 해서 회원가입 전체를 실패로 바꾸지는 않는다.  
회원가입 API가 들어올 때 할인 쿠폰과 관련된 로직만 따로 메시지 큐에 적재하고 추후에 발급하게 하는 것이 유리하다.

# 반론2

예상치 못한 피크라는 전제부터가 잘못되었다는 의견.  
트래픽을 예상해서 여분의 서버를 열어놓을 수 있다면 이게 최상이고, 그렇지 못한 경우라면 애초에 막을 방법이 없다.
